# API 레퍼런스 및 참고자료

## 전역 함수

### 레이어 관련

#### layer(layer_spec)
입력 레이아웃에서 레이어 가져오기

**매개변수:**
- `layer_spec` (String): 레이어 지정 문자열

**레이어 지정 형식:**
- `"layer/datatype"`: 예) `"1/0"`
- `"layer_name"`: 예) `"METAL1"`
- `"file.gds", "layer/datatype"`: 외부 파일에서
- `"file.gds", "layer_name"`: 외부 파일에서

**반환값:** Layout data 객체

**예제:**
```ruby
m1 = layer("1/0")
metal = layer("METAL1")
pattern = layer("input.gds", "1/0")
```

---

#### mask(layout_data)
레이아웃 데이터를 리소 마스크로 지정

**매개변수:**
- `layout_data`: Layer data 객체

**반환값:** Mask data 객체

**예제:**
```ruby
l1 = layer("1/0")
m = mask(l1)
metal = m.grow(0.3)
```

---

#### output(layer_spec, material)
재료를 출력 레이아웃에 기록

**매개변수:**
- `layer_spec` (String): 출력 레이어
- `material`: Material data 객체

**예제:**
```ruby
output("0/0", substrate)
output("1/0", metal)
```

**주의:**
- 동일 레이어에 여러 번 output 시 덮어씌워짐
- 디버깅 시 중간 상태 확인용으로 사용 가능

---

### 재료 관련

#### bulk
웨이퍼 기판을 나타내는 의사 재료

**반환값:** Material data 객체 (매번 새 객체)

**예제:**
```ruby
substrate = bulk
mask(pattern).etch(0.5, :into => substrate)
output("0/0", substrate)
```

**주의:**
- 읽기 전용이므로 변수에 저장 필요
- 호출마다 새 객체 생성

---

#### all
전체 웨이퍼를 덮는 의사 마스크

**반환값:** Mask data 객체

**예제:**
```ruby
oxide = all.grow(0.5)
# 또는
oxide = deposit(0.5)
```

---

#### deposit(height, lateral, options...)
균일 증착 (마스크 없음)

**동의어:** `grow`, `diffuse`

**매개변수:**
- `height` (Float): 두께 (µm)
- `lateral` (Float, 선택): 측면 확장 (µm)
- `options`: grow와 동일한 옵션

**반환값:** Material data 객체

**예제:**
```ruby
oxide = deposit(0.5)
nitride = deposit(0.3, 0.1, :mode => :round)
```

---

#### etch(height, lateral, options...)
균일 식각 (마스크 없음)

**매개변수:**
- `height` (Float): 깊이 (µm)
- `lateral` (Float, 선택): 언더컷 (µm)
- `options`: mask.etch와 동일한 옵션

**예제:**
```ruby
etch(0.3, :into => oxide)
```

---

#### planarize(options...)
평탄화 (CMP)

**옵션:**
| 옵션 | 타입 | 설명 |
|------|------|------|
| `:into` | Material/Array | (필수) 제거할 재료 |
| `:downto` | Material | 정지 재료 |
| `:less` | Float | 최상단에서 거리 (µm) |
| `:to` | Float | 절대 z 값 (µm) |

**예제:**
```ruby
planarize(:downto => substrate, :into => metal)
planarize(:less => 0.5, :into => oxide)
planarize(:to => 1.0, :into => [metal, oxide])
```

---

### 설정 함수

#### depth(d)
처리 깊이 또는 웨이퍼 두께 설정

**매개변수:**
- `d` (Float): 깊이 (µm), 기본값: 2

---

#### height(h), below(b), extend(x)
처리 윈도우 설정

**기본값:** 모두 2 µm

---

#### dbu(d)
계산 데이터베이스 단위 설정/조회

**예제:**
```ruby
dbu(0.0001)  # 0.1 nm 해상도
current = dbu  # 현재 값
```

---

#### delta(d)
정밀도 파라미터 설정

**기본값:** 10 DBU

---

#### flip
앞면/뒷면 전환

---

#### layers_file(filename)
레이어 속성 파일 지정

---

#### pause(msg), snapshot(name)
디버깅 함수

---

## Layer Data 메서드

### Boolean 연산
- `or(other)` - 합집합
- `and(other)` - 교집합
- `xor(other)` - 대칭차
- `not(other)` - 차집합

### 크기 조정
- `size(s)` / `size(x, y)` - in-place
- `sized(s)` / `sized(x, y)` - 복사본

### 반전
- `invert` - in-place
- `inverted` - 복사본

---

## Mask Data 메서드

### grow(height, lateral, options...)
증착 또는 재료 변환

**매개변수:**
- `height` (Float): 두께 (µm, 필수)
- `lateral` (Float): 측면 확장 (µm, 기본값: 0)

**옵션:**
| 옵션 | 값 | 설명 |
|------|-----|------|
| `:mode` | `:square`, `:round`, `:octagon` | 프로파일 모드 |
| `:taper` | Float (도) | 테이퍼 각도 |
| `:bias` | Float (µm) | 프로파일 이동 |
| `:on` | Material/Array | 선택적 증착 |
| `:into` | Material/Array | 재료 변환 |
| `:through` | Material/Array | 통과 재료 |
| `:buried` | Float (µm) | 깊이 |

**반환값:** Material data 객체

---

### etch(height, lateral, options...)
식각

**매개변수:**
- `height` (Float): 깊이 (µm, 필수)
- `lateral` (Float): 언더컷 (µm, 기본값: 0)

**옵션:**
| 옵션 | 값 | 설명 |
|------|-----|------|
| `:mode` | `:square`, `:round`, `:octagon` | 프로파일 모드 |
| `:taper` | Float (도) | 테이퍼 각도 |
| `:bias` | Float (µm) | 프로파일 이동 |
| `:into` | Material/Array | (필수) 식각 재료 |
| `:through` | Material/Array | 통과 재료 |
| `:buried` | Float (µm) | 깊이 |

---

## 옵션 상세 설명

### :mode
- `:square` - 사각형 프로파일 (기본값, 빠름)
- `:round` - 타원형 프로파일 (현실적)
- `:octagon` - 팔각형 프로파일 (절충안)

### :taper
- 테이퍼 각도 (도 단위)
- `:mode`와 함께 사용 불가
- 원뿔형/경사 프로파일 생성

### :bias
- 프로파일을 도형 내부로 이동
- 양수: 도형 축소
- 음수: 도형 확대

### :on (grow만)
- 선택적 증착
- 지정된 재료 표면에만 증착
- 단일 재료 또는 배열

### :into
- **grow**: 재료 변환 (위가 아닌 아래로)
- **etch**: 제거할 재료 (필수!)
- 단일 재료 또는 배열

### :through
- 선택적 공정
- 지정 재료를 통과
- `:into`와 함께 사용

### :buried
- 표면 아래 깊이에서 공정 적용
- 깊은 이온주입, 캐비티 생성

---

## Ruby 문법 참고

### 변수
```ruby
substrate = bulk
metal = deposit(0.5)
```

### 배열
```ruby
materials = [metal, oxide, nitride]
mask(via).etch(0.5, :into => materials)
```

### 조건문
```ruby
if USE_CMP
  planarize(:less => 0.1, :into => metal)
end
```

### 반복문
```ruby
(1..5).each do |i|
  layer_name = "#{i}/0"
  # ...
end
```

### 함수 정의
```ruby
def deposit_metal(thickness, lateral=0)
  deposit(thickness, lateral, :mode => :round)
end

metal = deposit_metal(0.5, 0.1)
```

---

## 단위 변환

### 길이 단위
- XSection은 **마이크로미터 (µm)** 사용
- 1 µm = 1000 nm
- 1 µm = 0.001 mm

### 변환 예제
| nm | µm | 사용 예 |
|----|-----|---------|
| 3 nm | 0.003 | 게이트 산화막 |
| 50 nm | 0.05 | 얇은 막 |
| 200 nm | 0.2 | 폴리실리콘 |
| 500 nm | 0.5 | ILD |
| 1000 nm | 1.0 | 두꺼운 금속 |

```ruby
# 3 nm 게이트 산화막
gate_ox = deposit(0.003)

# 200 nm 폴리실리콘
poly = deposit(0.2)

# 500 nm ILD
ild = deposit(0.5)
```

---

## 온라인 리소스

### 공식 문서
- **XSection 홈페이지**: https://klayoutmatthias.github.io/xsection/
- **소개 문서**: https://klayoutmatthias.github.io/xsection/DocIntro
- **API 레퍼런스**: https://klayoutmatthias.github.io/xsection/DocReference
- **Grow 메서드**: https://klayoutmatthias.github.io/xsection/DocGrow
- **Etch 메서드**: https://klayoutmatthias.github.io/xsection/DocEtch

### GitHub
- **소스 코드**: https://github.com/klayoutmatthias/xsection
- **이슈 트래커**: https://github.com/klayoutmatthias/xsection/issues
- **예제 파일**: https://github.com/klayoutmatthias/xsection/tree/master/docs

### KLayout
- **KLayout 홈페이지**: https://www.klayout.de
- **포럼**: https://www.klayout.de/forum
- **문서**: https://www.klayout.de/doc.html

### Ruby 학습
- **Ruby 공식 사이트**: https://www.ruby-lang.org
- **Try Ruby**: https://try.ruby-lang.org
- **Ruby in Twenty Minutes**: https://www.ruby-lang.org/en/documentation/quickstart/

---

## 예제 파일 위치

### 설치 후 위치
KLayout 패키지 관리자로 설치 시:
- Windows: `C:\Users\[사용자]\.klayout\salt\xsection\`
- Linux: `~/.klayout/salt/xsection/`
- macOS: `~/Library/Application Support/KLayout/salt/xsection/`

### 주요 예제
- `cmos.xs` - CMOS 공정 예제
- `sample1.xs` - 기본 예제
- `*.lyp` - 레이어 속성 파일

---

## 일반적인 패턴

### 패턴 1: 기본 금속 패터닝
```ruby
metal_mask = layer("METAL")
substrate = bulk

# 산화막
oxide = deposit(0.5)

# 트렌치
mask(metal_mask.inverted).etch(0.6, :into => oxide)

# 금속 충진
metal = deposit(0.5)

# CMP
planarize(:downto => oxide, :into => metal)
```

### 패턴 2: Via 형성
```ruby
via_mask = layer("VIA")

# ILD
ild = deposit(0.6)

# Via 개구
mask(via_mask).etch(0.6, :into => ild)

# 충진
via_metal = deposit(0.6)
planarize(:downto => ild, :into => via_metal)
```

### 패턴 3: 이온주입
```ruby
implant_mask = layer("IMPLANT")
substrate = bulk

implant = mask(implant_mask).grow(
  0.2,      # 깊이
  0.1,      # 확산
  :mode => :round,
  :into => substrate
)
```

### 패턴 4: STI
```ruby
active = layer("ACTIVE")
substrate = bulk

# 트렌치
mask(active).etch(0.3, :into => substrate)

# 충진
oxide = deposit(0.4)

# CMP
nitride = # (이전 단계에서)
planarize(:downto => nitride, :into => oxide)
```

---

## 빠른 참조표

### 주요 함수

| 함수 | 목적 | 필수 인자 |
|------|------|-----------|
| `layer()` | 레이어 가져오기 | layer_spec |
| `mask()` | 마스크 생성 | layout_data |
| `grow()` | 증착/변환 | height |
| `etch()` | 식각 | height, :into |
| `deposit()` | 균일 증착 | height |
| `planarize()` | 평탄화 | :into, 정지조건 |
| `output()` | 출력 | layer, material |

### 주요 옵션

| 옵션 | 적용 | 값 |
|------|------|-----|
| `:mode` | grow, etch | :square, :round, :octagon |
| `:taper` | grow, etch | 각도 (도) |
| `:bias` | grow, etch | 거리 (µm) |
| `:into` | grow, etch | Material/Array |
| `:on` | grow | Material/Array |
| `:through` | grow, etch | Material/Array |
| `:buried` | grow, etch | 깊이 (µm) |

### 기본값

| 설정 | 기본값 |
|------|--------|
| depth | 2 µm |
| height | 2 µm |
| below | 2 µm |
| extend | 2 µm |
| delta | 10 DBU |
| lateral | 0 µm |
| mode | :square |

---

## 문제 해결 체크리스트

### ❌ 스크립트가 실행되지 않음
- [ ] KLayout 버전 0.25 이상?
- [ ] XSection 패키지 설치됨?
- [ ] .xs 파일 확장자 올바름?
- [ ] Ruby 문법 오류 없음?

### ❌ 식각이 작동하지 않음
- [ ] `:into` 옵션 지정했는지?
- [ ] 올바른 재료 지정했는지?
- [ ] 재료가 변수에 저장되어 있는지?

### ❌ 마스크 극성이 잘못됨
- [ ] `.inverted` 사용 필요한지?
- [ ] 그려진 부분을 제거/보존 의도 확인

### ❌ 경계에 아티팩트
- [ ] `extend` 값 충분한지?
- [ ] `lateral` 값보다 큰지?

### ❌ 정밀도 문제
- [ ] `dbu` 값 적절한지?
- [ ] `delta` 값 조정 필요한지?

### ❌ 뒷면 공정 오류
- [ ] `depth` 설정했는지?
- [ ] `flip` 순서 올바른지?

---

## 다음 단계

- [[07_FAQ]] - 자주 묻는 질문
- [[08_Troubleshooting]] - 문제 해결 가이드

## 태그
#api #reference #documentation #ruby #cheatsheet
